\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage[left=2.54cm, right=2.54cm, top=2.54cm, bottom=2.54cm]{geometry}
\usepackage{hyperref} %for reference automatically
\usepackage{fancyhdr}

\pagestyle{fancy} % for header and footer
\fancyhf{}
\fancyhead[LE,RO]{Prepared by: Phayuth}
\fancyhead[RE,LO]{Supervisor : Dr.Sarot Srang}
\fancyfoot[LE,RO]{Page \thepage}
\renewcommand{\headrulewidth}{2pt}
\renewcommand{\footrulewidth}{1pt} % for header and footer

% THIS IS THE XML CODE INCLUDE==============================================================
\usepackage{listings}
\usepackage{xcolor}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstset{
	backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
	keywordstyle=\color{magenta},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	numbers=left,
	breaklines=true,
	tabsize=2,
	basicstyle=\ttfamily\footnotesize,
	literate={\ \ }{{\ }}1
}


\begin{document}
	\section*{\centering Lesson 2 : Kalman Filter}
	\section{Background}
	Kalman Filter was found by Dr. Rudolf Emil Kálmán. This algorithm is a powerful filtering algorithm that has been used in many applications most notably in signal processing, control, optimization, sensor fusion, system identification -etc , and it is able to be implemented online.
	\section{Kalman Filter (Linear System)}
	Consider a linear discrete time system as following:
	\begin{equation}
		\begin{split}
			x_{k+1} &= Ax_k + Bu_k + v_k \\
			y_{k+1} &= Cx_{k+1} + Du_{k+1} + w_{k+1}
		\end{split}
		\label{eq1}
	\end{equation}
	Where:
	\begin{itemize}
		\item {\makebox[1cm]{\(x_k\)\hfill} is voltage at terminal conductor of motor }
		\item {\makebox[1cm]{\(u_k\)\hfill} is back emf constant}
		\item {\makebox[1cm]{\(y_k\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(A\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(C\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(B\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(D\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(v_k\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(w_k\)\hfill} is angular velocity of motor}
	\end{itemize}
	\begin{center}
		\textbf{Apply Kalman Filter on the system}
	\end{center}
	\textbf{Initialize:}\\
	Select any
	\begin{itemize}
		\item {\makebox[1cm]{\(\hat{x}_{0|0}\)\hfill} initial state estimate}
		\item {\makebox[1cm]{\(P_{0|0}\)\hfill} positive definite error covariance matrix}
	\end{itemize}
	\textbf{Time Update} \\
	\begin{equation}
		\begin{split}
			\hat{x}_{k+1|k} = A\hat{x}_{k|k} + Bu_k \\
			P_{k+1|k} = AP_{k|k}A^T + Q
		\end{split}
		\label{eq2}
	\end{equation}
	\textbf{Measurement Update} \\
	\begin{equation}
		\begin{split}
			\hat{y}_{k+1|k} &= C\hat{x}_{k+1|k} + Du_{k+1} \\
			P_{xy,k+1|k} &= P_{k+1|k}C^T  \\
			P_{yy,k+1|k} &= CP_{k+1|k}C^T + R \\
			\hat{x}_{k+1|k+1} &= \hat{x}_{k+1|k} + P_{xy,k+1|k}P^{-1}_{yy,k+1|k}(y_k - \hat{y}_{k+1|k}) \\
			P_{k+1|k+1} &= P_{k+1|k} - P_{xy,k+1|k}P^{-1}_{yy,k|k+1}P^T_{xy,k+1|k}
		\end{split}
		\label{eq3}
	\end{equation}
	In terms of Kalman Gain,
	\begin{equation}
		\begin{split}
			K_{k+1} &= P_{xy,k+1|k}P^{-1}_{yy,k+1|k}\\
			\hat{x}_{k+1|k+1} &= \hat{x}_{k+1|k} + K_{k+1}(y_{k+1} - C\hat{x}_{k+1|k} - Du_{k+1}) \\
			P_{k+1|k+1} &= P_{k+1|k} - K_{k+1} P_{yy,k+1|k}K^T_{k+1}
		\end{split}
		\label{eq4}
	\end{equation}
	\section{Extended Kalman Filter (Nonlinear System)}
	Consider a nonlinear discrete time system as following:
	\begin{equation}
		\begin{split}
			x_{k+1} &= f_d(x_k+u_k) + v_k \\
			y_{k+1} &= h_d(x_{k+1},u_{k+1}) + w_{k+1}
		\end{split}
		\label{eq5}
	\end{equation}
	Where:
	\begin{itemize}
		\item {\makebox[1cm]{\(x_k\)\hfill} is voltage at terminal conductor of motor }
		\item {\makebox[1cm]{\(u_k\)\hfill} is back emf constant}
		\item {\makebox[1cm]{\(y_k\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(f_d\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(h_d\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(v_k\)\hfill} is angular velocity of motor}
		\item {\makebox[1cm]{\(w_k\)\hfill} is angular velocity of motor}
	\end{itemize}
	\begin{center}
		\textbf{Apply Extended Kalman Filter on the system}
	\end{center}
	\textbf{Initialize:}\\
	Select any
	\begin{itemize}
		\item {\makebox[1cm]{\(\hat{x}_{0|0}\)\hfill} initial state estimate}
		\item {\makebox[1cm]{\(P_{0|0}\)\hfill} positive definite error covariance matrix}
	\end{itemize}
	\textbf{Time Update}
	\begin{equation}
		\begin{split}
			\hat{x}_{k+1|k} &= f_d(\hat{x}_{k|k},u_k) \\
			P_{k+1|k} &= A_kP_{k|k}A^T_k+Q
		\end{split}
		\label{eq6}
	\end{equation}
	\textbf{Measurement Update}
	\begin{equation}
		\begin{split}
			\hat{y}_{k+1|k} &= h_d(\hat{x}_{k+1|k},u_{k+1})\\
			P_{xy,k+1|k}    &= P_{k+1|k}C^T_{k+1}\\
			P_{yy,k+1|k}    &= C_{k+1}P_{k+1|k}C^T_{k+1}+R\\
			\hat{x}_{k+1|k+1} &= \hat{x}_{k+1|k} + P_{xy,k+1|k}P^{-1}_{yy,k+1|k}(y_{k+1}-\hat{y}_{k+1|k})\\
			P_{k+1|k+1}     &= P_{k+1|k} - P_{xy,k+1|k}P^{-1}_{yy,k|k+1}P^T_{xy,k+1|k} 
		\end{split}
		\label{eq7}
	\end{equation}
	In terms of Kalman Gain,
	\begin{equation}
		\begin{split}
			K_{k+1} &= P_{xy,k+1|k}P^{-1}_{yy,k+1|k}\\
			\hat{x}_{k+1|k+1} &= \hat{x}_{k+1|k} + K_{k+1}[y_{k+1} - h_d(\hat{x}_{k+1|k},u_{k+1})] \\
			P_{k+1|k+1} &= P_{k+1|k} - K_{k+1} P_{yy,k+1|k}K^T_{k+1}
		\end{split}
		\label{eq8}
	\end{equation}
	Where from linearization of nonlinear function $f_d$ and $h_d$ using a Taylor series expansion, We get Jacobian matrix:
	\[A_k = \frac{\partial f_d}{\partial x}|_{x=\hat{x}_{k|k}}\]
	\[C_{k+1} = \frac{\partial h_d}{\partial x}|_{x=\hat{x}_{k+1|k}}\]
	\section{Unscented Kalman Filter (Nonlinear System)}
	Consider a nonlinear discrete time system as following:
	\begin{equation}
		\begin{split}
			x_{k+1} &= f_d(x_k+u_k) + v_k \\
			y_{k+1} &= h_d(x_{k+1},u_{k+1}) + w_{k+1}
		\end{split}
		\label{eq9}
	\end{equation}
	\begin{center}
		\textbf{Apply Unscented Kalman Filter on the system}
	\end{center}
	\textbf{Initialize:}\\
	Select any
	\begin{itemize}
		\item {\makebox[1cm]{\(\hat{x}_{0|0}\)\hfill} initial state estimate}
		\item {\makebox[1cm]{\(P_{0|0}\)\hfill} positive definite error covariance matrix}
	\end{itemize}
	\textbf{Time Update}
	\begin{equation}
		\begin{split}
			X_{k|k} &= [\hat{x}_{k|k}\quad ...\quad \hat{x}_{k|k}]+\sqrt{n_x + \lambda}[0\quad \sqrt{P_{k|k}}\quad -\sqrt{P_{k|k}}]\\
			X_{k+1|k} &= f_d(X_{k|k},u_k)\\
			\hat{x}_{k+1|k} &= X_{k+1|k}w_m\\
			P_{k+1|k} &= X_{k+1|k}WX^T_{k+1|k} + Q
		\end{split}
		\label{eq10}
	\end{equation}
	\textbf{Measurement Update}
	\begin{equation}
		\begin{split}
			X^{(r)}_{k+1|k} &= [\hat{x}_{k+1|k}\quad ...\quad \hat{x}_{k+1|k}]+\sqrt{n_x + \lambda}[0\quad \sqrt{P_{k+1|k}}\quad -\sqrt{P_{k+1|k}}]\\
			Y_{k+1|k} &= h_d(X^{(r)}_{k+1|k},u_{k+1})\\
			\hat{y}_{k+1|k} &= Y_{k+1|k} w_m\\
			P_{xy,k+1|k} &= X^{(r)}_{k+1|k}WY^T_{k+1|k}\\
			P_{yy,k+1|k} &= Y_{k+1|k}WY^T_{k+1|k} + R \\
			K_{k+1} &= P_{xy,k+1|k}P^{-1}_{yy,k+1|k}\\
			\hat{x}_{k+1|k+1} &= \hat{x}_{k+1|k} + K_{k+1}(y_{k+1}-\hat{y}_{k+1|k})\\
			P_{k+1|k+1} &= P_{k+1|k} - K_{k+1}P_{yy,k+1|k}K^T_{k+1}
		\end{split}
		\label{eq11}
	\end{equation}
\end{document}